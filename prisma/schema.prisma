generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  name         String
  email        String   @unique
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("users")
}

model Marketplace {
  id     String  @id @default(uuid())
  titulo String
  vendas Venda[]

  @@map("marketplaces")
}

model Venda {
  id              String   @id @default(uuid())
  nf              String   @unique
  loja            String
  baseIcms        Decimal
  comissaoVenda   Decimal? @map("comissao_venda")
  comissaoFrete   Decimal? @map("comissao_frete")
  desconto        Decimal?
  liquidoReceber  Decimal  @map("liquido_receber")
  
  // --- NOVOS CAMPOS ---
  // Define o total de vezes que a venda foi parcelada (ex: 12)
  qtdParcelas     Int?     @map("qtd_parcelas") 

  // Relacionamentos
  marketplaceId   String
  marketplace     Marketplace @relation(fields: [marketplaceId], references: [id])
  pagamentos      Pagamento[]

  createdAt       DateTime @default(now())
  @@map("vendas")
}

model Pagamento {
  id            String   @id @default(uuid())
  valor         Decimal
  data          DateTime
  nfVenda       String   @map("nf_venda")
  
  // --- NOVOS CAMPOS ---
  // Define qual é o número desta parcela específica (ex: 1, 2, 3...)
  numeroParcela Int?     @map("numero_parcela")

  // Relacionamento com Venda
  vendaId       String
  venda         Venda    @relation(fields: [vendaId], references: [id])

  @@map("pagamentos")
}